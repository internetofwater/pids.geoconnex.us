name: pids.geoconnex.us build

on:
  # workflow_dispatch:
  push:
    branches:
      - "dev"
      # - "main"
    # paths:
    #   - "build/namespaces/**"

jobs:
  build_sitemap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Generate Sitemap
        env:
          SOURCE_REPO: geoconnex.us
          SITEMAP_DIR: ./sitemap
        run: |
          git clone -b master https://github.com/internetofwater/geoconnex.us.git ${SOURCE_REPO}
          pip3 install git+https://github.com/cgs-earth/sitemap-generator.git
          sitemap-generator run ${PWD}/build/namespaces

      - name: Archive Sitemap
        uses: actions/upload-artifact@v3
        with:
          name: sitemap
          path: ./sitemap

  build_sqldump:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Generate SQL Dump
        uses: cgs-earth/yourls-action@0.1.0
        with:
          filepath: ./build/namespaces

      - name: Archive SQL Dump
        uses: actions/upload-artifact@v3
        with:
          name: yourls
          path: ./yourls.sql.gz
